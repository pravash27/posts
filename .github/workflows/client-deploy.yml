name: deploy-client
on:
    push:
        branches:
            - master
        paths: 
            - 'client/**'
jobs:
    build:
        runs-on: ubuntu-latest
        steps:
            - name: Code Checkout
              uses: actions/checkout@v2
            
            - name: build docker image
              run: cd client && docker build - ${{secrets.GKE_REGISTRY_URL}}/${{secrets.GKE_PROJECT_ID}}/client

            - name: Setup google cloud
              uses: google-github-actions/setup-gcloud@v0
              with:
                project_id: ${{secrets.GKE_PROJECT_ID}} 
                service_account_key: ${{secrets.GKE_APPLICATION_CREDENTIALS}}
                export_default_credentials: true
            
            - name: Push docker image
              env: 
                GOOGLE_PROJECT: ${{secrets.GKE_PROJECT_ID}}
              run: 
                gcloud auth configure-docker us-central1-docker.pkg.dev
                docker push ${{secrets.GKE_REGISTRY_URL}}/${{secrets.GKE_PROJECT_ID}}/client
            